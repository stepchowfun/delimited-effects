%%%%%%%%%%%%%%%%%%%%%
% Document settings %
%%%%%%%%%%%%%%%%%%%%%

\documentclass[12pt]{article}

\title{Long-distance interaction \\ between caller and callee}
\author{Stephan Boyer and Esther Wang}
\date{}

%%%%%%%%%%%%
% Packages %
%%%%%%%%%%%%

\usepackage[colorlinks]{hyperref}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bussproofs}
\usepackage{mathtools}
\usepackage{mdframed}
\usepackage{stackengine} % For stacking axioms

%%%%%%%%%%
% Macros %
%%%%%%%%%%

% Misc
\newcommand\parens[1]{\left(#1\right)}
\newcommand\sub[3]{#1 \left[#2\mapsto#3\right]}

% Terms
\newcommand\eterm{t}
\newcommand\evalue{v}
\newcommand\econst{c}
\newcommand\evar{x}
\newcommand\eabs[2]{\lambda#1\;.\;#2}
\newcommand\eapp[2]{#1\ #2}
\newcommand\eprovide[4]{\text{provide}\ #1\ \text{as}\ #2\ \text{using}\ #3\ \text{in}\ #4}

% Provide
\newcommand\pall{S}
\newcommand\pitem[2]{#1\mapsto#2}
\newcommand\pempty{\varnothing_{\pall}}
\newcommand\pextend[2]{#1, #2}

% Types
\newcommand\ttype{\tau}
\newcommand\tconst{\kappa}
\newcommand\tvar{\alpha}
\newcommand\tarrow[2]{#1\rightarrow#2}
\newcommand\tanno[2]{#1:#2}
\newcommand\tjudgment[3]{#1\vdash\tanno{#2}{#3}}
\newcommand\tx{\sigma}
\newcommand\twithx[2]{#1\;!\;#2}

% Effects
\newcommand\xeffect{\varepsilon}
\newcommand\xeffects{E}
\newcommand\xempty{\varnothing_{\xeffect}}
\newcommand\xextend[2]{#1, #2}
\newcommand\xunion[2]{#1, #2}
\newcommand\xc{\Delta}
\newcommand\xcempty{\varnothing_{\xc}}
\newcommand\xcextend[2]{#1, #2}
\newcommand\xcitem[2]{#1 = #2}

% Contexts
\newcommand\ccontext{\Gamma}
\newcommand\cempty{\varnothing_{\ccontext}}
\newcommand\cextend[2]{#1, #2}
\newcommand\cunion[2]{#1, #2}

%%%%%%%%%%%%%%%%%%%%%
% The specification %
%%%%%%%%%%%%%%%%%%%%%

\begin{document}

  \maketitle

  \begin{figure}
    \begin{mdframed}
      \begin{center}
        \begin{tabular}{l l l}
          $\eterm \Coloneqq $ & & term \\
          & $\evalue$ & value \\
          & $\evar$ & variable \\
          & $\eapp{\eterm}{\eterm}$ & application \\
          & $\eprovide{\pall}{\xeffect}{\xeffects}{\eterm}$ & provide \\
          $\evalue \Coloneqq $ & & value \\
          & $\econst$ & constant \\
          & $\eabs{\tanno{\evar}{\ttype}}{\eterm}$ & abstraction \\
          $\pall \Coloneqq$ & & effect handler \\
          & $\pempty$ & empty handler \\
          & $\pextend{\pall}{\pitem{\evar}{\eterm}}$ & handler extension \\
          $\xc \Coloneqq$ & & effect context \\
          & $\xcempty$ & empty effect context \\
          & $\xcextend{\xc}{\xcitem{\xeffect}{\ccontext}}$ & effect context extension \\
          $\ttype \Coloneqq$ & & type \\
          & $\tconst$ & type of constants \\
          & $\tarrow{\tx}{\tx}$ & arrow type \\
          $\tx \Coloneqq$ & & type with effects \\
          & $\twithx{\xeffects}{\ttype}$ & effect annotation \\
          $\xeffects \Coloneqq$ & & effect set \\
          & $\xempty$ & empty effect \\
          & $\xextend{\xeffects}{\xeffect}$ & effect extension \\
          $\ccontext \Coloneqq$ & & context \\
          & $\cempty$ & empty context \\
          & $\cextend{\ccontext}{\tanno{\evar}{\ttype}}$ & variable binding \\
        \end{tabular}
      \end{center}

      \caption{Syntax}\label{fig:syntax}
    \end{mdframed}
  \end{figure}

  \begin{figure}
    \begin{mdframed}
      \begin{center}
        \framebox{$\tjudgment{\ccontext}{\eterm}{\tx}$}
      \end{center}

      \medskip

      \begin{prooftree}
          \AxiomC{}
        \RightLabel{(\textsc{T-Constant})}
        \UnaryInfC{$\tjudgment{\ccontext}{\econst}{\twithx{\xempty}{\tconst}}$}
      \end{prooftree}

      \begin{prooftree}
          \AxiomC{$\tanno{\evar}{\tx} \in \ccontext$}
        \RightLabel{(\textsc{T-Variable})}
        \UnaryInfC{$\tjudgment{\ccontext}{\evar}{\tx}$}
      \end{prooftree}

      \begin{prooftree}
        \AxiomC{$\tjudgment{\cextend{\ccontext}{\tanno{\evar}{\ttype}}}{\eterm}{\tx}$}
        \RightLabel{(\textsc{T-Abstraction})}
        \UnaryInfC{$\tjudgment{\ccontext}{\eabs{\tanno{\evar}{\ttype}}{\eterm}}{\tarrow{\ttype}{\tx}}$}
      \end{prooftree}

      \begin{prooftree}
        \AxiomC{\Shortstack[c]{{$\tjudgment{\ccontext}{\eterm_1}{\twithx{\xunion{\xeffects_1}{\xeffects_3}}{\ttype_1}}$}
          {$\tjudgment{\ccontext}{\eterm_2}{\twithx{\xeffects_2}{\tarrow{\parens{\twithx{\xeffects_3}{\ttype_1}}}{\twithx{\xeffects_4}{\ttype_2}}}}$}}}
        \RightLabel{(\textsc{T-Application})}
        \UnaryInfC{$\tjudgment{\ccontext}{\eapp{\eterm_2}{\eterm_1}}{\twithx{\xunion{\xeffects_1}{\xunion{\xeffects_2}{\xeffects_4}}}{\ttype_2}}$}
      \end{prooftree}

      \begin{prooftree}
        \AxiomC{\Shortstack[c]{{$\pall = \pextend{\pextend{\pextend{\pempty}{\pitem{\evar_1}{\eterm_1}}}{\ldots}}{\pitem{\evar_n}{\eterm_n}}$}
          {$\tjudgment{\ccontext_1}{\eterm_i}{\twithx{\xunion{\xeffects_1}{\xeffects_i}}{\ttype_i}}$}
          {$\tx_i = \twithx{\xextend{\xeffects_i}{\xeffect}}{\ttype_i}$}
          {$\xcitem{\xeffect}{\ccontext_2} \in \xc$}
          {$\ccontext_2 = \cextend{\cextend{\cextend{\cempty}{\tanno{\evar_1}{\tx_1}}}{\ldots}}{\tanno{\evar_n}{\tx_n}}$}
          {$\tjudgment{\cunion{\ccontext_1}{\ccontext_2}}{\eterm}{\twithx{\xeffects_2}{\ttype}}$}}}
        \RightLabel{(\textsc{T-Provide})}
        \UnaryInfC{$\tjudgment{\ccontext_1}{\eprovide{\pall}{\xeffect}{\xeffects_1}{\eterm}}{\twithx{\xunion{\xeffects_1}{\xeffects_2} - \xeffect}{\ttype}}$}
      \end{prooftree}

      \begin{prooftree}
          \AxiomC{$\tjudgment{\ccontext}{\eterm}{\twithx{\xeffects}{\ttype}}$}
        \RightLabel{(\textsc{T-Weaken})}
        \UnaryInfC{$\tjudgment{\ccontext}{\eterm}{\twithx{\xextend{\xeffects}{\xeffect}}{\ttype}}$}
      \end{prooftree}

      \caption{Typing rules}\label{fig:typing_rules}
    \end{mdframed}
  \end{figure}

\end{document}
