%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Document settings and packages %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifuseacm
\newcommand\ifnoacm{\ifuseacm\else}
\newcommand\ifacm{\ifuseacm}

% Comment out this line to disable the acmart document class
% \useacmtrue

\ifnoacm
  \documentclass[12pt]{article}
\fi

\ifacm
  \documentclass[format=acmsmall, review=false, screen=true]{acmart}
\fi

\usepackage[T1]{fontenc} % The font encoding
\usepackage[varqu]{zi4} % Inconsolata font with straight quotes
\usepackage{amssymb} % For \varnothing
\usepackage{bussproofs} % For inference rules
\usepackage{float} % For the [H] option in \begin{figure}[H]. NOTE: Stop using this when we have more content
\usepackage{listings} % For source code
\usepackage{mathtools} % For \Coloneqq
\usepackage{stackengine} % For stacking axioms
\usepackage{stmaryrd} % For \llbracket and \rrbracket

\ifnoacm
  \usepackage[margin=1in]{geometry} % For setting the margin
  \usepackage{xcolor} % For \definecolor{...}{...}{...}
\fi

%%%%%%%%%%%%
% Metadata %
%%%%%%%%%%%%

\title{Reflection and entanglement}

\ifacm
  \author{Stephan Boyer}
  \orcid{0000-0003-4599-2683}
  \affiliation{%
    \institution{Airbnb, Inc.}
    \streetaddress{888 Brannan St.}
    \city{San Francisco}
    \state{CA}
    \postcode{94103}
    \country{USA}}
  \email{stephan@stephanboyer.com}

  \acmJournal{PACMPL}
  \acmVolume{3}
  \acmNumber{POPL}
  \acmArticle{39}
  \acmYear{2019}
  \acmMonth{3}
  \acmDOI{0000001.0000001}

  \setcopyright{acmlicensed}
  \copyrightyear{2018}

  \received{February 2018}
  \received[revised]{March 2018}
  \received[accepted]{June 2018}

% For some reason, LaTeX throws an error if this is indented.
% This was generated by: http://dl.acm.org/ccs.cfm
\begin{CCSXML}
  <ccs2012>
    <concept>
      <concept_id>10003752.10010124.10010125.10010130</concept_id>
      <concept_desc>Theory of computation~Type structures</concept_desc>
      <concept_significance>500</concept_significance>
    </concept>
    <concept>
      <concept_id>10003752.10010124.10010131.10010134</concept_id>
      <concept_desc>Theory of computation~Operational semantics</concept_desc>
      <concept_significance>300</concept_significance>
    </concept>
    <concept>
      <concept_id>10011007.10011006.10011008.10011009.10011012</concept_id>
      <concept_desc>Software and its engineering~Functional languages</concept_desc>
      <concept_significance>500</concept_significance>
    </concept>
  </ccs2012>
\end{CCSXML}

  \ccsdesc[500]{Theory of computation~Type structures}
  \ccsdesc[300]{Theory of computation~Operational semantics}
  \ccsdesc[500]{Software and its engineering~Functional languages}

  \keywords{Type classes, algebraic effects, effect handlers, reflection, entanglement}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%
% Source code formatting %
%%%%%%%%%%%%%%%%%%%%%%%%%%

\lstdefinelanguage{gram}{
  comment=[l]{\#},
  morekeywords={reify, reflect, as, in, data, let, where},
}

\ifnoacm
  \definecolor{ACMDarkBlue}{cmyk}{1,0.58,0,0.21}
  \definecolor{ACMPurple}{cmyk}{0.55,1,0,0.15}
\fi

\lstset{
  aboveskip=\bigskipamount,
  basicstyle=\ttfamily,
  belowskip=\bigskipamount,
  commentstyle=\color{ACMDarkBlue},
  keepspaces=true,
  keywordstyle=\bfseries\color{ACMPurple},
  language=gram,
}

\input{paper/macros.tex}

%%%%%%%%%%%%%%%
% The writeup %
%%%%%%%%%%%%%%%

\begin{document}
  \ifacm
    \citestyle{acmauthoryear}

    % The `acmart` layout requires the abstract to be before \maketitle.
    % But the `article` layout requires the abstract to be after \maketitle.
    \begin{abstract}
      \input{paper/abstract.tex}
    \end{abstract}
  \fi

  \maketitle

  \ifnoacm
    % The `acmart` layout requires the abstract to be before \maketitle.
    % But the `article` layout requires the abstract to be after \maketitle.
    \begin{abstract}
      \input{paper/abstract.tex}
    \end{abstract}
  \fi

  \input{paper/intro.tex}
  \input{paper/overview.tex}
  \input{paper/reflection.tex}
  \input{paper/entanglement.tex}

  \ifnoacm
    \section{Acknowledgements}
      \input{paper/acknowledgements.tex}
  \fi

  \ifacm
% For some reason, LaTeX throws an error if this is indented.
\begin{acks}
  \input{paper/acknowledgements.tex}
\end{acks}
  \fi

  \ifacm
    \bibliographystyle{ACM-Reference-Format}
  \else
    \bibliographystyle{apalike}
  \fi

  \bibliography{references}
\end{document}
